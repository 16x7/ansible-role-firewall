# -----------------------------------------------------------------------------
# Handlers file: roles/firewall/handlers/main.yml
#
# Purpose:
#   Define handlers triggered by the firewall role to reload the active ruleset
#   for the selected backend.
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Reload nftables configuration from /etc/nftables.conf
# This handler applies the rendered ruleset directly with `nft -f` to avoid
# relying on systemd reload semantics that can vary inside containers.
# -----------------------------------------------------------------------------
- name: Reload nftables ruleset
  ansible.builtin.command: nft -f /etc/nftables.conf
  register: nft_reload
  changed_when: nft_reload.rc == 0

# -----------------------------------------------------------------------------
# Reload iptables-persistent (netfilter-persistent) rules
# -----------------------------------------------------------------------------
- name: Reload iptables ruleset
  ansible.builtin.command: netfilter-persistent reload
  register: ipt_reload
  changed_when: ipt_reload.rc == 0
