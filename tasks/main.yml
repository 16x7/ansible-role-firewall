- name: Merge firewall overrides with defaults
  ansible.builtin.set_fact:
    firewall: "{{ firewall_defaults | default({}) | combine(firewall | default({}), recursive=True) }}"

- name: Validate firewall inputs
  import_tasks: validate_inputs.yml

- name: Install firewall backend dependencies
  import_tasks: install_dependencies.yml

- name: Ensure only the selected firewall backend is active
  import_tasks: ensure_backend_exclusive.yml

- name: Ensure selected firewall backend service is enabled and running
  import_tasks: ensure_backend_active.yml

- name: Generate firewall configuration
  import_tasks: configure_firewall.yml
