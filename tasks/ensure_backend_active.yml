# -----------------------------------------------------------------------------
# Task file: roles/firewall/tasks/ensure_backend_active.yml
#
# Purpose:
#   Ensure the selected firewall backend service is enabled and running.
#
# Description:
#   - For `nftables`, enables and starts the `nftables` service.
#   - For `iptables2`, enables and starts `netfilter-persistent` (manages
#     iptables-persistent rules).
#
# Requirements:
#   - `firewall.backend` must be either `nftables` or `iptables2`.
#
# Output:
#   - The chosen firewall backend service is active and enabled at boot.
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Step 1 – Ensure nftables service is active
# -----------------------------------------------------------------------------
- name: Ensure nftables service is enabled and running
  ansible.builtin.systemd:
    name: nftables
    state: started
    enabled: yes
  when: firewall.backend == 'nftables'

# -----------------------------------------------------------------------------
# Step 2 – Ensure iptables-persistent service is active
# -----------------------------------------------------------------------------
- name: Ensure netfilter-persistent (iptables) service is enabled and running
  ansible.builtin.systemd:
    name: netfilter-persistent
    state: started
    enabled: yes
  when: firewall.backend == 'iptables2'
